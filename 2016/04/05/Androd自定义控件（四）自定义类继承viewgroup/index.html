<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="自定义控件,官方demo,ViewGroup" />





  <link rel="alternate" href="/atom.xml" title="KIKO_奶糖的博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="自定义类继承ViewGroup。">
<meta name="keywords" content="自定义控件,官方demo,ViewGroup">
<meta property="og:type" content="article">
<meta property="og:title" content="Androd自定义控件（四）自定义类继承viewgroup">
<meta property="og:url" content="http://yoursite.com/2016/04/05/Androd自定义控件（四）自定义类继承viewgroup/index.html">
<meta property="og:site_name" content="KIKO_奶糖的博客">
<meta property="og:description" content="自定义类继承ViewGroup。">
<meta property="og:image" content="http://img.blog.csdn.net/20160405181247461">
<meta property="og:updated_time" content="2017-04-24T01:23:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Androd自定义控件（四）自定义类继承viewgroup">
<meta name="twitter:description" content="自定义类继承ViewGroup。">
<meta name="twitter:image" content="http://img.blog.csdn.net/20160405181247461">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'X6XZYA04JV',
      apiKey: 'abdb5abda2ee8a5e60a5682dea929ef0',
      indexName: 'renleicoder',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/04/05/Androd自定义控件（四）自定义类继承viewgroup/"/>





  <title>Androd自定义控件（四）自定义类继承viewgroup | KIKO_奶糖的博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f298a9ae5a2d1230596870c757ed632b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">KIKO_奶糖的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">每个人都在成为大神的路上，只不过有的人在走，而有的人在跑。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/05/Androd自定义控件（四）自定义类继承viewgroup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="任磊_Coder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KIKO_奶糖的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Androd自定义控件（四）自定义类继承viewgroup
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-05T14:44:00+08:00">
                2016-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/自定义控件/" itemprop="url" rel="index">
                    <span itemprop="name">自定义控件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/05/Androd自定义控件（四）自定义类继承viewgroup/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/04/05/Androd自定义控件（四）自定义类继承viewgroup/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/04/05/Androd自定义控件（四）自定义类继承viewgroup/" class="leancloud_visitors" data-flag-title="Androd自定义控件（四）自定义类继承viewgroup">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>自定义类继承ViewGroup。</p>
<a id="more"></a>
<p>在前面已经跟大家分享了，自定义view概述，自定义view需要知道的方法，自定义类继承view，自定义组合控件。今天跟大家分享一下自定义类继承viewgroup，当初挖的坑也就快填完了（四种自定义view，今天是第三种），希望大家能有所收获。</p>
<h3 id="1-自定义viewgroup和组合控件的区别"><a href="#1-自定义viewgroup和组合控件的区别" class="headerlink" title="1.自定义viewgroup和组合控件的区别"></a>1.自定义viewgroup和组合控件的区别</h3><p>从目的来看：<strong>大部分情况下组合控件是用创建一个囊括逻辑和布局的视图的方式，达到重复使用而不用在不同的场合中写重复的代码目的，而自定义viewgroup是更倾向于自定义属性来定制 ViewGroup 中子视图的位置。</strong></p>
<p>从实现方式来看：<strong>组合控件的一般需要加载一个已经写好的布局，声明方法来控制布局中写好的控件,不需要自己处理viewgroup的测量和布局的过程，比如自定义的App顶栏等。而自定义viewgroup一般是通过measure和layout来控制子view的位置，比如流式布局等。</strong></p>
<h3 id="2-ViewGroup概述"><a href="#2-ViewGroup概述" class="headerlink" title="2.ViewGroup概述"></a>2.ViewGroup概述</h3><p>A ViewGroup is a special view that can contain other views (called children.) The view group is the base class for layouts and views containers. This class also defines the ViewGroup.LayoutParams class which serves as the base class for layouts parameters. </p>
<p><strong>一个ViewGroup是一个可以包含其他view的特殊View，ViewGroup是各个Layout和View容器组件的基类。这个类还定义了ViewGroup.LayoutParams类来作为布局参数的基类。</strong></p>
<p>LayoutParams are used by views to tell their parents how they want to be laid out.<br>The base LayoutParams class just describes how big the view wants to be for both width and height.</p>
<p><strong>LayoutParams 通常是子view用来告诉父容器他们的位置。基类LayoutParams 仅仅描述了子view的宽和高。</strong></p>
<h3 id="3-ViewGroup和LayoutParams之间的关系"><a href="#3-ViewGroup和LayoutParams之间的关系" class="headerlink" title="3.ViewGroup和LayoutParams之间的关系"></a>3.ViewGroup和LayoutParams之间的关系</h3><p>不知道大家有没有注意到，当我们在LinearLayout中写子View的时候，可以用layout_gravity，layout_weight属性；而zaiRelativeLayout中的子View有layout_centerInParent属性，却没有layout_gravity，layout_weight，这是为什么呢？<strong>这是因为每个ViewGroup需要指定一个LayoutParams，用于确定支持子View哪些属性。</strong></p>
<h3 id="4-Android绘制视图的方式"><a href="#4-Android绘制视图的方式" class="headerlink" title="4.Android绘制视图的方式"></a>4.Android绘制视图的方式</h3><p>Layout is a two pass process: a measure pass and a layout pass. The measuring pass is implemented in measure(int, int) and is a top-down traversal of the view tree. Each view pushes dimension specifications down the tree during the recursion. At the end of the measure pass, every view has stored its measurements. The second pass happens in layout(int, int, int, int) and is also top-down. During this pass each parent is responsible for positioning all of its children using the sizes computed in the measure pass. </p>
<p><strong>绘制布局由两个遍历过程组成： 测量过程和布局过程。 测量过程由 measure(int, int) 方法完成， 该方法从上到下遍历视图树。 在递归遍历过程中， 每个视图都会向下层传递尺寸和规格。 当measure 方法遍历结束， 每个视图都保存了各自的尺寸信息。 第二个过程由 layout(int, int, int,int) 方法完成， 该方法也是由上而下遍历视图树， 在遍历过程中， 每个父视图通过测量过程的结果定位所有子视图的位置信息。</strong></p>
<h3 id="5-自定义viewgroup的步骤"><a href="#5-自定义viewgroup的步骤" class="headerlink" title="5.自定义viewgroup的步骤"></a>5.自定义viewgroup的步骤</h3><p>我们以官方文档中的demo为例。这是一个相对综合的例子，处理的几乎所有的布局情况。通过这个demo我们可以举一反三，把特殊情况简单。先看下效果图：</p>
<p><img src="http://img.blog.csdn.net/20160405181247461" alt="这里写图片描述"></p>
<p>实现效果：<strong>自定义类继承viewgroup实现linearlayout横向摆放的效果，并且自定义属性“layout_position”来控制子view在水平方向的位置。</strong></p>
<h4 id="自定义类继承ViewGroup，并初始化"><a href="#自定义类继承ViewGroup，并初始化" class="headerlink" title="自定义类继承ViewGroup，并初始化"></a>自定义类继承ViewGroup，并初始化</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">@RemoteViews.RemoteView</div><div class="line">public class CustomLayout extends ViewGroup &#123;</div><div class="line">    /** The amount of space used by children in the left gutter. */</div><div class="line">    private int mLeftWidth;</div><div class="line"></div><div class="line">    /** The amount of space used by children in the right gutter.</div><div class="line">     * 计算右侧的子view需要的空间。</div><div class="line">     */</div><div class="line">    private int mRightWidth;</div><div class="line"></div><div class="line">    /** These are used for computing child frames based on their gravity.</div><div class="line">     * 计算子view基于他们gravity的画面</div><div class="line">     */</div><div class="line">    private final Rect mTmpContainerRect = new Rect();</div><div class="line">    private final Rect mTmpChildRect = new Rect();</div><div class="line"></div><div class="line">    public CustomLayout(Context context) &#123;</div><div class="line">        super(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public CustomLayout(Context context, AttributeSet attrs) &#123;</div><div class="line">        this(context, attrs, 0);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public CustomLayout(Context context, AttributeSet attrs, int defStyle) &#123;</div><div class="line">        super(context, attrs, defStyle);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>这里需要注意的一点是，如果我们自定义的viewgroup不需要滚动的话，尽量重写shouldDelayChildPressedState方法，并返回false。</strong></p>
<p>Return true if the pressed state should be delayed for children or descendants of this ViewGroup. Generally, this should be done for containers that can scroll, such as a List. This prevents the pressed state from appearing when the user is actually trying to scroll the content. The default implementation returns true for compatibility reasons. Subclasses that do not scroll should generally override this method and return false. </p>
<p>官方文档中的说明是，<strong>当返回false的时候，如果用户试图滚动内容，会阻止这个viewgroup出现按压状态。出于兼容的目的，这个方法默认是返回true的。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Any layout manager that doesn&apos;t scroll will want this.</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public boolean shouldDelayChildPressedState() &#123;</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="为子视图添加自定义属性"><a href="#为子视图添加自定义属性" class="headerlink" title="为子视图添加自定义属性"></a>为子视图添加自定义属性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;resources&gt;</div><div class="line"></div><div class="line">    &lt;declare-styleable name=&quot;CustomLayoutLP&quot;&gt;</div><div class="line">        &lt;attr name=&quot;android:layout_gravity&quot;/&gt;</div><div class="line">        &lt;attr name=&quot;layout_position&quot;&gt;</div><div class="line">            &lt;enum name=&quot;middle&quot; value=&quot;0&quot;/&gt;</div><div class="line">            &lt;enum name=&quot;left&quot; value=&quot;1&quot;/&gt;</div><div class="line">            &lt;enum name=&quot;right&quot; value=&quot;2&quot;/&gt;</div><div class="line">        &lt;/attr&gt;</div><div class="line">    &lt;/declare-styleable&gt;</div><div class="line"></div><div class="line">&lt;/resources&gt;</div></pre></td></tr></table></figure>
<p><strong>因为属性名的前缀是layout_，没有包含一个视图属性，因此该属性会被添加到LayoutParams的属性表中。</strong></p>
<p>同时，在onMeasure方法之前，要先创建一个自定义的LayoutParams，该类用于存储每个子视图的gravity和position。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">    * Custom per-child layout information.</div><div class="line">    * 创建自定义 LayoutParams类， 该类用于保存每个子视图的信息（gravity,position）</div><div class="line">    */</div><div class="line">   public static class LayoutParams extends MarginLayoutParams &#123;</div><div class="line">       /**</div><div class="line">        * The gravity to apply with the View to which these layout parameters</div><div class="line">        * are associated.</div><div class="line">        */</div><div class="line">       public int gravity = Gravity.TOP | Gravity.START;</div><div class="line"></div><div class="line">       public static int POSITION_MIDDLE = 0;</div><div class="line">       public static int POSITION_LEFT = 1;</div><div class="line">       public static int POSITION_RIGHT = 2;</div><div class="line"></div><div class="line">       public int position = POSITION_MIDDLE;</div><div class="line"></div><div class="line">       public LayoutParams(Context c, AttributeSet attrs) &#123;</div><div class="line">           super(c, attrs);</div><div class="line"></div><div class="line">           // Pull the layout param values from the layout XML during</div><div class="line">           // inflation.  This is not needed if you don&apos;t care about</div><div class="line">           // changing the layout behavior in XML.</div><div class="line">           TypedArray a = c.obtainStyledAttributes(attrs, R.styleable.CustomLayoutLP);</div><div class="line">           gravity = a.getInt(R.styleable.CustomLayoutLP_android_layout_gravity, gravity);</div><div class="line">           position = a.getInt(R.styleable.CustomLayoutLP_layout_position, position);</div><div class="line">           a.recycle();</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       public LayoutParams(int width, int height) &#123;</div><div class="line">           super(width, height);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       public LayoutParams(ViewGroup.LayoutParams source) &#123;</div><div class="line">           super(source);</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>要使用新定义的layoutparams，我们可能需要重写的方法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// The rest of the implementation is for custom per-child layout parameters.</div><div class="line">    // If you do not need these (for example you are writing a layout manager</div><div class="line">    // that does fixed positioning of its children), you can drop all of this.</div><div class="line"> @Override</div><div class="line">    public LayoutParams generateLayoutParams(AttributeSet attrs) &#123;</div><div class="line">        return new CustomLayout.LayoutParams(getContext(), attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected LayoutParams generateDefaultLayoutParams() &#123;</div><div class="line">        return new LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected ViewGroup.LayoutParams generateLayoutParams(ViewGroup.LayoutParams p) &#123;</div><div class="line">        return new LayoutParams(p);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected boolean checkLayoutParams(ViewGroup.LayoutParams p) &#123;</div><div class="line">        return p instanceof LayoutParams;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>但是从注释中我们了解到：<strong>如果我们用不到这些方法，比如我们的viewgroup中的子view是固定的，那么我们可以丢掉他们。</strong></p>
<h4 id="重写onMeasure（）方法"><a href="#重写onMeasure（）方法" class="headerlink" title="重写onMeasure（）方法"></a>重写onMeasure（）方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * Ask all children to measure themselves and compute the measurement of this</div><div class="line">     * layout based on the children.</div><div class="line">     * 令每个子视图测量自身，计算该viewgroup基于子view的尺寸</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">        int count = getChildCount();</div><div class="line"></div><div class="line">        // These keep track of the space we are using on the left and right for</div><div class="line">        // views positioned there; we need member variables so we can also use</div><div class="line">        // these for layout later.</div><div class="line">        mLeftWidth = 0;</div><div class="line">        mRightWidth = 0;</div><div class="line"></div><div class="line">        // Measurement will ultimately be computing these values.</div><div class="line">        //使用宽和高计算布局的最终大小</div><div class="line">        int maxHeight = 0;</div><div class="line">        int maxWidth = 0;</div><div class="line">        int childState = 0;</div><div class="line"></div><div class="line">        // Iterate through all children, measuring them and computing our dimensions</div><div class="line">        // from their size.</div><div class="line">        //遍历所有的孩子,从他们的大小测量和计算我们的大小</div><div class="line">        for (int i = 0; i &lt; count; i++) &#123;</div><div class="line">            final View child = getChildAt(i);</div><div class="line">            if (child.getVisibility() != GONE) &#123;</div><div class="line">                // Measure the child.</div><div class="line">                //令每个子视图测量自身</div><div class="line">                measureChildWithMargins(child, widthMeasureSpec, 0, heightMeasureSpec, 0);</div><div class="line"></div><div class="line">                // Update our size information based on the layout params.  Children</div><div class="line">                // that asked to be positioned on the left or right go in those gutters.</div><div class="line">                final LayoutParams lp = (LayoutParams) child.getLayoutParams();</div><div class="line">                if (lp.position == LayoutParams.POSITION_LEFT) &#123;</div><div class="line">                    mLeftWidth += Math.max(maxWidth,</div><div class="line">                            child.getMeasuredWidth() + lp.leftMargin + lp.rightMargin);</div><div class="line">                &#125; else if (lp.position == LayoutParams.POSITION_RIGHT) &#123;</div><div class="line">                    mRightWidth += Math.max(maxWidth,</div><div class="line">                            child.getMeasuredWidth() + lp.leftMargin + lp.rightMargin);</div><div class="line">                &#125; else &#123;</div><div class="line">                    maxWidth = Math.max(maxWidth,</div><div class="line">                            child.getMeasuredWidth() + lp.leftMargin + lp.rightMargin);</div><div class="line">                &#125;</div><div class="line">                maxHeight = Math.max(maxHeight,</div><div class="line">                        child.getMeasuredHeight() + lp.topMargin + lp.bottomMargin);</div><div class="line">                childState = combineMeasuredStates(childState, child.getMeasuredState());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // Total width is the maximum width of all inner children plus the gutters.</div><div class="line">        maxWidth += mLeftWidth + mRightWidth;</div><div class="line"></div><div class="line">        // Check against our minimum height and width</div><div class="line">        maxHeight = Math.max(maxHeight, getSuggestedMinimumHeight());</div><div class="line">        maxWidth = Math.max(maxWidth, getSuggestedMinimumWidth());</div><div class="line"></div><div class="line">        // Report our final dimensions.</div><div class="line">        //使用计算的到的宽和高设置整个布局的测量尺寸</div><div class="line">        setMeasuredDimension(resolveSizeAndState(maxWidth, widthMeasureSpec, childState),</div><div class="line">                resolveSizeAndState(maxHeight, heightMeasureSpec,</div><div class="line">                        childState &lt;&lt; MEASURED_HEIGHT_STATE_SHIFT));</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="最后一步为onLayout（）方法"><a href="#最后一步为onLayout（）方法" class="headerlink" title="最后一步为onLayout（）方法"></a>最后一步为onLayout（）方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * Position all children within this layout.</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</div><div class="line">        final int count = getChildCount();</div><div class="line"></div><div class="line">        // These are the far left and right edges in which we are performing layout.</div><div class="line">        int leftPos = getPaddingLeft();</div><div class="line">        int rightPos = right - left - getPaddingRight();</div><div class="line"></div><div class="line">        // This is the middle region inside of the gutter.</div><div class="line">        final int middleLeft = leftPos + mLeftWidth;</div><div class="line">        final int middleRight = rightPos - mRightWidth;</div><div class="line"></div><div class="line">        // These are the top and bottom edges in which we are performing layout.</div><div class="line">        final int parentTop = getPaddingTop();</div><div class="line">        final int parentBottom = bottom - top - getPaddingBottom();</div><div class="line"></div><div class="line">        for (int i = 0; i &lt; count; i++) &#123;</div><div class="line">            final View child = getChildAt(i);</div><div class="line">            if (child.getVisibility() != GONE) &#123;</div><div class="line">                final LayoutParams lp = (LayoutParams) child.getLayoutParams();</div><div class="line"></div><div class="line">                final int width = child.getMeasuredWidth();</div><div class="line">                final int height = child.getMeasuredHeight();</div><div class="line"></div><div class="line">                // Compute the frame in which we are placing this child.</div><div class="line">                if (lp.position == LayoutParams.POSITION_LEFT) &#123;</div><div class="line">                    mTmpContainerRect.left = leftPos + lp.leftMargin;</div><div class="line">                    mTmpContainerRect.right = leftPos + width + lp.rightMargin;</div><div class="line">                    leftPos = mTmpContainerRect.right;</div><div class="line">                &#125; else if (lp.position == LayoutParams.POSITION_RIGHT) &#123;</div><div class="line">                    mTmpContainerRect.right = rightPos - lp.rightMargin;</div><div class="line">                    mTmpContainerRect.left = rightPos - width - lp.leftMargin;</div><div class="line">                    rightPos = mTmpContainerRect.left;</div><div class="line">                &#125; else &#123;</div><div class="line">                    mTmpContainerRect.left = middleLeft + lp.leftMargin;</div><div class="line">                    mTmpContainerRect.right = middleRight - lp.rightMargin;</div><div class="line">                &#125;</div><div class="line">                mTmpContainerRect.top = parentTop + lp.topMargin;</div><div class="line">                mTmpContainerRect.bottom = parentBottom - lp.bottomMargin;</div><div class="line"></div><div class="line">                // Use the child&apos;s gravity and size to determine its final</div><div class="line">                // frame within its container.</div><div class="line">                Gravity.apply(lp.gravity, width, height, mTmpContainerRect, mTmpChildRect);</div><div class="line"></div><div class="line">                // Place the child.</div><div class="line">                //放置子view</div><div class="line">                child.layout(mTmpChildRect.left, mTmpChildRect.top,</div><div class="line">                        mTmpChildRect.right, mTmpChildRect.bottom);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>上述逻辑并不复杂，循环调用子view的onlayout方法，根据onMeasure的到的参数对子view进行布局。</p>
<h4 id="在布局文件中使用"><a href="#在布局文件中使用" class="headerlink" title="在布局文件中使用"></a>在布局文件中使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;oracleen.customlayout.CustomLayout</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!-- put first view to left. --&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_gravity=&quot;fill_vertical|center_horizontal&quot;</div><div class="line">        android:background=&quot;@color/test1&quot;</div><div class="line">        android:text=&quot;l1&quot;</div><div class="line">        app:layout_position=&quot;left&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!-- stack second view to left. --&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_gravity=&quot;fill_vertical|center_horizontal&quot;</div><div class="line">        android:background=&quot;@color/test1&quot;</div><div class="line">        android:text=&quot;l2&quot;</div><div class="line">        app:layout_position=&quot;left&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!-- also put a view on the right. --&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_gravity=&quot;fill_vertical|center_horizontal&quot;</div><div class="line">        android:background=&quot;@color/test1&quot;</div><div class="line">        android:text=&quot;r1&quot;</div><div class="line">        app:layout_position=&quot;right&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!-- by default views go in the middle; use fill vertical gravity --&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_gravity=&quot;fill_vertical|center_horizontal&quot;</div><div class="line">        android:background=&quot;@color/test2&quot;</div><div class="line">        android:text=&quot;fill-vert&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!-- by default views go in the middle; use fill horizontal gravity --&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;30dp&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_gravity=&quot;center_vertical|fill_horizontal&quot;</div><div class="line">        android:background=&quot;@color/test2&quot;</div><div class="line">        android:text=&quot;fill-horiz&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!-- by default views go in the middle; use top-left gravity --&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_gravity=&quot;top|left&quot;</div><div class="line">        android:background=&quot;@color/test3&quot;</div><div class="line">        android:text=&quot;top-left&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!-- by default views go in the middle; use center gravity --&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_gravity=&quot;center&quot;</div><div class="line">        android:background=&quot;@color/test3&quot;</div><div class="line">        android:text=&quot;center&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!-- by default views go in the middle; use bottom-right --&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_gravity=&quot;bottom|right&quot;</div><div class="line">        android:background=&quot;@color/test3&quot;</div><div class="line">        android:text=&quot;bottom-right&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/oracleen.customlayout.CustomLayout&gt;</div></pre></td></tr></table></figure>
<p>好，到这里基本就结束了。源码我也上传了，大部分方法都加了注释，<a href="http://download.csdn.net/detail/sdkfjksf/9482002" target="_blank" rel="external">点击这里下载。</a></p>

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/wechatqcode.png" alt="任磊_Coder wechat" style="width: 200px; max-width: 100%;"/>
    <div>关注博主是一种态度，评论博主是一种欣赏。</div>
</div>


      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat.png" alt="任磊_Coder WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay.png" alt="任磊_Coder Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/自定义控件/" rel="tag"># 自定义控件</a>
          
            <a href="/tags/官方demo/" rel="tag"># 官方demo</a>
          
            <a href="/tags/ViewGroup/" rel="tag"># ViewGroup</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/04/09/这些Tips让你的App更容易维护/" rel="next" title="这些Tips让你的App更容易维护">
                <i class="fa fa-chevron-left"></i> 这些Tips让你的App更容易维护
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/03/29/Material Design实战/" rel="prev" title="Material Design实战">
                Material Design实战 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpeg"
               alt="任磊_Coder" />
          <p class="site-author-name" itemprop="name">任磊_Coder</p>
           
              <p class="site-description motion-element" itemprop="description">每个人都在成为大神的路上，只不过有的人在走，而有的人在跑。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">39</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">81</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/PleaseCallMeCoder" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2729748535/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1e" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/575326a8ce05" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/sdkfjksf" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-自定义viewgroup和组合控件的区别"><span class="nav-number">1.</span> <span class="nav-text">1.自定义viewgroup和组合控件的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ViewGroup概述"><span class="nav-number">2.</span> <span class="nav-text">2.ViewGroup概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-ViewGroup和LayoutParams之间的关系"><span class="nav-number">3.</span> <span class="nav-text">3.ViewGroup和LayoutParams之间的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Android绘制视图的方式"><span class="nav-number">4.</span> <span class="nav-text">4.Android绘制视图的方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-自定义viewgroup的步骤"><span class="nav-number">5.</span> <span class="nav-text">5.自定义viewgroup的步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义类继承ViewGroup，并初始化"><span class="nav-number">5.1.</span> <span class="nav-text">自定义类继承ViewGroup，并初始化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#为子视图添加自定义属性"><span class="nav-number">5.2.</span> <span class="nav-text">为子视图添加自定义属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重写onMeasure（）方法"><span class="nav-number">5.3.</span> <span class="nav-text">重写onMeasure（）方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#最后一步为onLayout（）方法"><span class="nav-number">5.4.</span> <span class="nav-text">最后一步为onLayout（）方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在布局文件中使用"><span class="nav-number">5.5.</span> <span class="nav-text">在布局文件中使用</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">任磊_Coder</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://renleicoder.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2016/04/05/Androd自定义控件（四）自定义类继承viewgroup/';
          this.page.identifier = '2016/04/05/Androd自定义控件（四）自定义类继承viewgroup/';
          this.page.title = 'Androd自定义控件（四）自定义类继承viewgroup';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://renleicoder.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  








  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.1"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("WRMNDFdhvgzhvChWrX6qyTJI-gzGzoHsz", "xM8HS64Yu434V4EvE8j9wLsf");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

</body>
</html>
